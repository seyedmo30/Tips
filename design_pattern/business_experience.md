# maani

# digital signature

### تجربیات بدست اومده

+ اولین سرویس جدی بود که خودم از lagacy  جداش کردم

+ برای دریافت امضا نیاز به چندین استپ بود ، باید به کلاینت هام getState  میدادم

+ برای ساخت امضا ۵ api  داشتیم که یک امضا رو تکمیل میکردن ، برای جلو گیری از خراب کاری باید ترتیب درخواست ها کنترل میشد و قبل هر درخواست checkState  میکردم، 

+ ما برای دریافت و پاسخ درخواست ها از kafka 

request handler  استفاده کردیم ، و یه ساختاری چیدیم ، اما برخی usecase  ها هستند که از این قاعده پیروی نمی کنند ، و بایددر ساختار پاسخ یا درخواست دست ببریم






+ اولین سرویس بود که هم apk , ios  استیت فول بود ، هم سرویس من ریپو داشت ،  هم پروایدر باید سینک میبود . و برای مدیریت این پاره شدم ، مثلا من هیچ وقت نمیدونستم apk  چه داده ای داره چون درخواست کننده همیشه اون بود ، و طبق سناریو قدیمی ، تنها موقع ساخت داکیومنت به من میگفت درون sdk   امضا داره یا نه
، مثلا گوشی اگه  clear cache میکرد ، من و پروایدر نمی دونستیم ، یا اگه امضا 

+ فهمیدم باید همون اول ساختار log stash  رو 

بگیریم و بدونیم لاگ ها توی dev  می افته یا نه

+ فهمیدم هر جا که i/o  داریم باید لاگ بزاریم

+ قدر git flow  رو دونستم ، چون هنوز کد من تست نشده بود ، ولی چون کلاینتم با این متودولوژی جلو نرفته بود و هر شب با dev  مرج میکرد ، مجبور شدیم کد من رو با دردسر روی پروداکت ببریم

+ فهمیدم اپ چقدر میتونه state less باشه ، چون شرکت ها نمی خوان همش force update  بدن. در نتیجه هیچ متن و هیچ کارتی رو خودشون ندارن و از بک اند میگیرن

، به این رسیدم که اپ ها حقیقتا فقط تمپلیت هستن ، و اینجا بار می افته رو دوش ادمین پنل ، چون ترتیب و کاشی های اپ اونجا چیده میشه

+ فهمیدم بالاخره ، بهتره از همون gorm  خودمون استفاده کرد ( کم کم دارم قدر django رو میدونم :) چون ورودی ها و خروجی ها رو میشه داینامیک کرد ، 

میشه برای تست از sqlite  استفاده کرد و در نهایت در صورت change  تنها بر روی استراکت تغییر اعمال میکنیم

+ تیبل های لگسی ، خوشبختانه زیاد join  نداشتن ولی من status  داشتم اما کد قدیمی چند تا boolian  داشت و seed که نوشتم کمی تغییر داشت

+  و data migration و ddl migration  رو با پایتون نوشتم

هنوز جدول کانفیگ برای این سرویس رو ننوشتم اما قیمت امضا ، اولین چیز بود که منو اذییت کرد ، توی dev امضا قیمت واقعیه و باید ۱۰۰۰تومن بکنم تا تست انجام شه


### قوانین

Ca سرتیفیکته آتوریتی

مثل اعتماد هوشمند یا مرکز اعتماد یا بانک ملی

Ra مرکز میانی

قانونه هر شخص با یک مرکز امضا داشته باشه
ولی شاید مانی یا دیجی پی از ایران ساین بگیرن در این حالت مرکز میانی میاد 



## Ekyc

+ لوانت

تشخیص صورت و چهره و میگه یه کار بکن



